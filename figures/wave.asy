import three;
import graph3;

settings.outformat = "png";
settings.render = 16;
defaultpen(fontsize(10pt));
size(200);
// currentprojection = perspective(3,2,1);
currentprojection = perspective(-1,-1.5,1);

// real f(pair z) {
//     int n = 3;
//     real r = 0.1;
//     return Jn(n,length(z-(1,1))/r);
// }

real f(pair z) {
    real pi = 3.1415926;
    real a = 1.5;
    real b = 0.1;
    real r = 0.0;
    // if (z.y<5) {
    //     if (a*(z.y-1)<=z.x && z.x<=a*z.y) {
    //         r += b*(1-cos(2*pi*(z.y-z.x/a)));
    //         // if (a*(z.y-8)>=-z.x && a*(z.y-9)<=-z.x) {
    //         //     r -= 0.5*b*(1-cos(2*pi*(z.y+z.x/a)));
    //         // }
    //     }
    // }
    // if (z.y>4) {
    //     // if (a*z.y>=-z.x && a*(z.y-1)<=-z.x) {
    //     if (a*(z.y-8)>=-z.x && a*(z.y-9)<=-z.x) {
    //         r += b*(1-cos(2*pi*(z.y+z.x/a)));
    //     }
    // }

    if (z.y<z.x) {
        return 0;
    } else if (z.x<z.y-1) {
        return 2/pi;
    } else {
        return (1-cos(pi*(z.y - z.x)))/pi;
    }
    return r;
}

surface s = surface(f, (0,0), (4,4), nx=200, ny=200);

// draw(s, surfacepen=gray(0.9));
// draw(s, surfacepen=gray(0.9)+opacity(0.5), nolight);
draw(s, surfacepen=gray(0.9)+opacity(0.5));
// xaxis3(Label(XY()*"$x$",align = -Y),0,5,Arrow3);
// yaxis3(Label(XY()*"$t$",align = -X),0,5,Arrow3);
draw((1,-0.5,0)--(3,-0.5,0), arrow=Arrow3(arrowhead=DefaultHead2,size=6),linewidth(1), L=Label("$x$", position=MidPoint));
draw((-0.5,1,0)--(-0.5,3,0), arrow=Arrow3(arrowhead=DefaultHead2,size=6),linewidth(1), L=Label("$t$", position=MidPoint));

real[][] coord = {
{0.0,0.0,0.0},
{4.0,0.0,0.0},
{0.0,1.0,0.0},
{4.0,1.0,0.0},
{0.0,2.0,0.0},
{4.0,2.0,0.0},
{0.0,3.0,0.0},
{4.0,3.0,0.0},
{0.0,4.0,0.0},
{4.0,4.0,0.0},
{0.3179997781347642,0.0,0.0},
{0.6359995562694706,0.0,0.0},
{0.9881349416050229,0.0,0.0},
{1.472505191816446,0.0,0.0},
{2.143458883781023,0.0,0.0},
{3.046000665591347,0.0,0.0},
{0.0,0.3210552329271151,0.0},
{0.0,0.642110465854877,0.0},
{0.3540276943063825,1.0,0.0},
{0.6712910880413542,1.0,0.0},
{0.9885544817761234,1.0,0.0},
{1.305817875510892,1.0,0.0},
{1.623081269245661,1.0,0.0},
{1.970880549089311,1.0,0.0},
{2.447645719714413,1.0,0.0},
{3.107487573610847,1.0,0.0},
{0.0,1.44463166976017,0.0},
{0.6108464003645109,2.0,0.0},
{1.057249555453197,2.0,0.0},
{1.38791757619151,2.0,0.0},
{1.69395878809405,2.0,0.0},
{1.999999999996633,2.0,0.0},
{2.306041211900828,2.0,0.0},
{2.612082423805066,2.0,0.0},
{2.942750444544523,2.0,0.0},
{3.389153599634401,2.0,0.0},
{4.0,2.55536833023983,0.0},
{0.8925124263849343,3.0,0.0},
{1.552354280279,3.0,0.0},
{2.029119450903067,3.0,0.0},
{2.376918730749335,3.0,0.0},
{2.694182124485238,3.0,0.0},
{3.011445518221141,3.0,0.0},
{3.328708911957044,3.0,0.0},
{3.645972305692947,3.0,0.0},
{4.0,3.35788953414447,0.0},
{4.0,3.678944767072235,0.0},
{0.9539993344029392,4.0,0.0},
{1.856541116208232,4.0,0.0},
{2.527494808175549,4.0,0.0},
{3.011865058390351,4.0,0.0},
{3.364000443728221,4.0,0.0},
{3.682000221864111,4.0,0.0},
{0.5179741215542861,0.7354060488796876,0.0},
{1.157711822502198,0.7191237846752994,0.0},
{1.812663061132477,0.6549587713226899,0.0},
{0.8120672489372469,0.2901770377672407,0.0},
{1.141037425424827,0.314350812946716,0.0},
{0.4829119797279917,0.2913912480902312,0.0},
{1.464449568620628,0.7252418435043053,0.0},
{0.8450138912717832,0.6827772220117818,0.0},
{0.293096008031935,0.4862533640231421,0.0},
{2.594729774686186,0.4089941501139326,0.0},
{0.2449501882222669,0.7538519668666709,0.0},
{1.513646070419568,0.363122627521713,0.0},
{2.209263134401861,0.659554838430487,0.0},
{3.446888270435754,0.4891293179533764,0.0},
{0.6112454462163885,0.496943036734088,0.0},
{0.2328249625772861,0.233650100521839,0.0},
{1.519982847191851,1.733305692296824,0.0},
{2.162253527518261,1.728247569345213,0.0},
{2.791271096125224,1.6652903002111,0.0},
{1.132235685879371,1.287858139178217,0.0},
{0.5126593911738686,1.274758158665263,0.0},
{1.796980909167486,1.287980585213854,0.0},
{0.8880664519024379,1.611771725255491,0.0},
{2.115739298884252,1.329303867719686,0.0},
{1.464362533718051,1.276685162802369,0.0},
{1.222583565822353,1.727851391578429,0.0},
{0.8283663169501421,1.253888774633497,0.0},
{2.459061815847311,1.734960537043933,0.0},
{1.842687975729126,1.686048080719726,0.0},
{3.539472127136629,1.446042087593008,0.0},
{0.4425769905754876,1.600599051594118,0.0},
{2.500172343987173,1.366753044474662,0.0},
{3.165952004807078,1.678724786592576,0.0},
{1.587258055419033,1.490726313601581,0.0},
{1.30154034770945,1.481892608713102,0.0},
{0.231260046019242,1.237789754534016,0.0},
{2.480017151896904,2.266694308022766,0.0},
{1.837746474681109,2.271752428014147,0.0},
{1.208728906684843,2.334709704316858,0.0},
{2.867764317366679,2.712141860174812,0.0},
{3.487340608824995,2.725241841333843,0.0},
{2.203019090826201,2.712019413034327,0.0},
{3.111933555021393,2.38822827185202,0.0},
{1.884260700861782,2.6706961358047,0.0},
{2.535637465385971,2.723314835133679,0.0},
{2.777416434174795,2.272148605531002,0.0},
{2.157312028220145,2.313951921597696,0.0},
{1.540938188660765,2.26503946034944,0.0},
{3.171633684856043,2.746111226574222,0.0},
{0.4605278714891757,2.553957896080158,0.0},
{3.557423007490716,2.399400939998291,0.0},
{1.499827673910897,2.633246974804229,0.0},
{0.8340479850425968,2.321275217456535,0.0},
{2.412741945091408,2.509273677621358,0.0},
{2.698459654339902,2.518107382014022,0.0},
{3.768739946882412,2.762210245914529,0.0},
{3.482025880231095,3.2645939490211,0.0},
{2.842288177520691,3.280876214245706,0.0},
{2.187336941166115,3.34504122695096,0.0},
{3.187932751059286,3.709822962231244,0.0},
{2.858962575202843,3.685649181314051,0.0},
{3.517088020269471,3.7086087519086,0.0},
{2.535550434374279,3.274758154765005,0.0},
{3.154986116573478,3.317222781598743,0.0},
{3.70690399660223,3.513746636940347,0.0},
{1.405270225305586,3.591005926209255,0.0},
{3.755049814023505,3.246148034574621,0.0},
{2.486353925718891,3.636877368368828,0.0},
{1.790736881735966,3.340445151821517,0.0},
{0.5531117201387922,3.51087066816804,0.0},
{3.388754563535488,3.503056965025831,0.0},
{3.767175034311459,3.766349905056549,0.0},


};

int[][] conn = {
{57,60,56},
{54,60,57},
{60,67,56},
{61,67,53},
{58,67,61},
{12,56,11},
{11,58,10},
{56,58,11},
{14,64,13},
{13,57,12},
{55,64,14},
{18,53,19},
{20,54,21},
{19,60,20},
{17,63,2},
{2,63,18},
{24,62,25},
{53,60,19},
{20,60,54},
{21,59,22},
{62,66,25},
{16,61,17},
{0,68,16},
{10,68,0},
{54,59,21},
{53,63,61},
{54,64,59},
{3,66,1},
{15,62,14},
{25,66,3},
{58,68,10},
{12,57,56},
{53,67,60},
{18,63,53},
{56,67,58},
{14,65,55},
{57,64,54},
{1,66,15},
{15,66,62},
{61,63,17},
{16,68,61},
{61,68,58},
{22,55,23},
{23,65,24},
{22,59,55},
{13,64,57},
{62,65,14},
{59,64,55},
{24,65,62},
{55,65,23},
{76,81,74},
{70,81,76},
{72,87,75},
{81,86,74},
{75,87,78},
{75,79,72},
{73,79,75},
{5,82,3},
{27,75,28},
{23,74,22},
{75,78,28},
{71,84,25},
{22,77,21},
{74,77,22},
{28,78,29},
{24,76,23},
{25,84,24},
{21,77,72},
{20,79,19},
{21,72,20},
{30,81,31},
{31,70,32},
{29,69,30},
{29,78,69},
{72,79,20},
{35,82,5},
{69,87,86},
{32,80,33},
{78,87,69},
{69,81,30},
{31,81,70},
{19,73,18},
{70,84,80},
{70,80,32},
{19,79,73},
{3,82,25},
{26,83,4},
{4,83,27},
{69,86,81},
{25,85,71},
{23,76,74},
{76,84,70},
{86,87,77},
{74,86,77},
{77,87,72},
{2,88,26},
{75,83,73},
{33,71,34},
{83,88,73},
{26,88,83},
{33,80,71},
{18,88,2},
{24,84,76},
{73,88,18},
{34,85,35},
{27,83,75},
{82,85,25},
{80,84,71},
{35,85,82},
{71,85,34},
{96,99,94},
{90,99,96},
{92,107,95},
{99,106,94},
{95,107,98},
{95,101,92},
{93,101,95},
{4,102,6},
{35,95,34},
{39,94,40},
{95,98,34},
{91,104,37},
{40,97,41},
{94,97,40},
{34,98,33},
{38,96,39},
{37,104,38},
{41,97,92},
{41,92,42},
{42,101,43},
{32,99,31},
{33,89,32},
{31,90,30},
{33,98,89},
{92,101,42},
{27,102,4},
{89,107,106},
{30,100,29},
{98,107,89},
{89,99,32},
{31,99,90},
{43,93,44},
{90,104,100},
{90,100,30},
{43,101,93},
{6,102,37},
{36,103,5},
{5,103,35},
{89,106,99},
{37,105,91},
{39,96,94},
{96,104,90},
{106,107,97},
{94,106,97},
{97,107,92},
{7,108,36},
{95,103,93},
{29,91,28},
{103,108,93},
{36,108,103},
{29,100,91},
{44,108,7},
{38,104,96},
{93,108,44},
{28,105,27},
{35,103,95},
{102,105,37},
{100,104,91},
{27,105,102},
{91,105,28},
{113,116,112},
{110,116,113},
{116,123,112},
{117,123,109},
{114,123,117},
{50,112,51},
{51,114,52},
{112,114,51},
{48,120,49},
{49,113,50},
{111,120,48},
{42,110,41},
{44,109,43},
{43,116,42},
{45,119,7},
{7,119,44},
{38,118,37},
{42,116,110},
{109,116,43},
{41,115,40},
{118,122,37},
{46,117,45},
{9,124,46},
{52,124,9},
{110,115,41},
{109,119,117},
{110,120,115},
{6,122,8},
{47,118,48},
{37,122,6},
{114,124,52},
{50,113,112},
{109,123,116},
{44,119,109},
{112,123,114},
{48,121,111},
{113,120,110},
{8,122,47},
{47,122,118},
{117,119,45},
{46,124,117},
{117,124,114},
{40,111,39},
{39,121,38},
{40,115,111},
{49,120,113},
{118,121,48},
{115,120,111},
{38,121,118},
{111,121,39},

};

// surface node = scale3(0.05)*unitsphere;
// for(real[] xyz: coord) {
//     real x = xyz[0];
//     real y = xyz[1];
//     real[] xy = {x, y};
//     draw(shift(x,y,f((x,y)))*node, black);
// }

for(int[] id: conn) {
    real x1 = coord[id[0]][0];
    real y1 = coord[id[0]][1];
    real x2 = coord[id[1]][0];
    real y2 = coord[id[1]][1];
    real x3 = coord[id[2]][0];
    real y3 = coord[id[2]][1];

    draw((x1,y1,f((x1,y1)))--(x2,y2,f((x2,y2)))--(x3,y3,f((x3,y3)))--(x1,y1,f((x1,y1))),linewidth(0.5));
}